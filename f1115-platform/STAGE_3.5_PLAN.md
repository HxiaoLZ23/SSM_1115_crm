# 阶段3.5：完善个人主页功能

## 📋 需求分析

### 当前问题
1. 个人主页过于简单，只显示基本信息
2. 无法查看用户发布的帖子
3. 无法编辑个人信息和简介
4. 缺少用户统计数据（发帖数、关注数、粉丝数）
5. 帖子详情页无法跳转到发帖人主页

### 功能目标
完善个人主页，使其成为用户的个人展示中心，为后续社交功能（关注、评论）打好基础。

---

## 🎯 功能设计

### 1. 个人主页布局

```
┌─────────────────────────────────────────┐
│            顶部导航栏                     │
└─────────────────────────────────────────┘
┌─────────────────────────────────────────┐
│  ┌─────────┐                            │
│  │ 用户头像 │  用户昵称                  │
│  └─────────┘  @用户名                    │
│              个人简介                     │
│              📊 10帖子 | 5关注 | 8粉丝   │
│              [编辑资料] [关注/取消关注]   │
└─────────────────────────────────────────┘
┌─────────────────────────────────────────┐
│  标签页：[我的帖子] [关注] [粉丝]        │
├─────────────────────────────────────────┤
│  帖子列表（分页）                        │
│  ┌───────────────────────────────────┐  │
│  │ 帖子1                              │  │
│  └───────────────────────────────────┘  │
│  ┌───────────────────────────────────┐  │
│  │ 帖子2                              │  │
│  └───────────────────────────────────┘  │
└─────────────────────────────────────────┘
```

### 2. 功能清单

#### 查看模式（查看他人主页）
- ✅ 用户基本信息展示（头像、昵称、用户名、简介）
- ✅ 用户统计数据（发帖数、关注数、粉丝数）
- ✅ 用户发布的帖子列表（分页）
- ✅ 关注/取消关注按钮（如果不是自己）
- ✅ 标签页切换（帖子、关注、粉丝）

#### 编辑模式（查看自己主页）
- ✅ 所有查看模式的功能
- ✅ 编辑资料按钮
- ✅ 编辑资料弹窗（昵称、邮箱、个人简介）
- ✅ 头像上传功能
- ✅ 不显示关注按钮（自己不能关注自己）

#### 跳转功能
- ✅ 帖子列表：点击发帖人头像/昵称 -> 跳转到该用户主页
- ✅ 帖子详情：点击发帖人头像/昵称 -> 跳转到该用户主页
- ✅ 评论列表：点击评论者头像/昵称 -> 跳转到该用户主页（后续）

---

## 🔧 技术实现

### 后端API（需要新增/修改）

#### 已有接口（需要确认）
- ✅ GET `/api/user/{userId}` - 获取用户信息（含统计数据）
- ✅ GET `/api/post/user/{userId}` - 获取用户发帖列表

#### 需要新增接口
- ⏳ PUT `/api/user/{userId}/avatar` - 更新头像
- ⏳ PUT `/api/user/{userId}/profile` - 更新个人资料

#### 需要修改接口
- ⏳ GET `/api/user/{userId}` - 确保返回统计数据（发帖数、关注数、粉丝数）

### 前端页面

#### 需要重构
- ⏳ `Profile.vue` - 完全重构个人主页

#### 需要修改
- ⏳ `Home.vue` - 添加点击头像/昵称跳转功能
- ⏳ `PostDetail.vue` - 添加点击头像/昵称跳转功能

#### 需要新增组件
- ⏳ `EditProfileDialog.vue` - 编辑资料弹窗（可选，可以直接在Profile.vue中实现）

---

## 📊 数据结构

### UserProfile扩展字段（已有）
```java
// 扩展字段（不在数据库中）
private Integer followingCount;  // 关注数
private Integer followerCount;   // 粉丝数
private Integer postCount;        // 发帖数
private Boolean isFollowed;       // 是否已关注
```

### API响应示例

**GET /api/user/{userId}**
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "id": 1,
    "username": "testuser",
    "nickname": "测试用户",
    "avatar": "/upload/images/xxx.jpg",
    "email": "test@test.com",
    "bio": "这是我的个人简介",
    "followingCount": 5,
    "followerCount": 8,
    "postCount": 10,
    "isFollowed": false
  }
}
```

---

## 🎨 UI设计要点

### 1. 个人信息区域
- 大头像（80-100px）
- 昵称（大字体，加粗）
- @用户名（小字体，灰色）
- 个人简介（多行文本）
- 统计数据（图标+数字，可点击）

### 2. 操作按钮区域
- 查看自己：[编辑资料] 按钮
- 查看他人：[关注]/[已关注] 按钮

### 3. 标签页
- 我的帖子（默认）
- 关注列表（后续开发）
- 粉丝列表（后续开发）

### 4. 帖子列表
- 复用Home.vue的帖子卡片样式
- 分页加载
- 点击跳转到帖子详情

---

## 📝 开发任务清单

### 阶段3.5任务

#### 后端任务
1. ✅ 确认UserMapper.selectUserWithStats已实现
2. ⏳ 创建头像上传接口
3. ⏳ 完善用户信息更新接口

#### 前端任务
1. ⏳ 重构Profile.vue页面
   - 用户信息展示区域
   - 统计数据展示
   - 编辑资料功能
   - 头像上传功能
   - 用户帖子列表
   - 标签页切换
2. ⏳ 修改Home.vue
   - 头像可点击跳转
   - 昵称可点击跳转
3. ⏳ 修改PostDetail.vue
   - 头像可点击跳转
   - 昵称可点击跳转
4. ⏳ 修改路由
   - 支持查看他人主页：`/user/:userId`
   - 查看自己主页：`/profile`（重定向到/user/当前用户ID）

---

## 🔄 路由设计

### 当前路由
```
/profile - 个人中心（只能看自己）
```

### 优化后路由
```
/profile - 重定向到 /user/{currentUserId}
/user/:userId - 用户主页（可以看任何人，包括自己）
```

---

## 🎯 开发优先级

### P0（必须完成）
1. ✅ 个人主页显示用户信息
2. ✅ 个人主页显示用户帖子列表
3. ✅ 编辑个人资料功能
4. ✅ 头像上传功能
5. ✅ 点击头像/昵称跳转到主页

### P1（建议完成）
1. ⏳ 统计数据可点击（跳转到关注/粉丝列表）
2. ⏳ 标签页切换动画
3. ⏳ 加载骨架屏

### P2（可选）
1. ⏳ 个人主页背景图
2. ⏳ 用户认证标识
3. ⏳ 用户等级系统

---

## 📊 预计工作量

- **后端开发**: 0.5天（主要是头像上传）
- **前端开发**: 1天（重构Profile.vue）
- **测试**: 0.5天
- **总计**: 2天

---

## ✅ 完成标准

### 功能测试
- ✅ 可以查看自己的主页
- ✅ 可以查看他人的主页
- ✅ 可以编辑自己的资料
- ✅ 可以上传头像
- ✅ 主页显示用户发布的帖子
- ✅ 从帖子列表可以跳转到用户主页
- ✅ 从帖子详情可以跳转到用户主页

### 数据准确性
- ✅ 统计数据正确（发帖数、关注数、粉丝数）
- ✅ 帖子列表正确
- ✅ 编辑后数据正确保存

---

## 🚀 下一步

完成阶段3.5后，才能顺利进入阶段四（社交功能）：
- 关注功能（需要在个人主页显示关注按钮）
- 评论功能（需要点击评论者跳转到主页）
- 点赞功能（需要查看谁点赞了）

---

**文档创建日期**: 2026-01-17  
**优先级**: 高（必须完成才能继续后续开发）
